# App Store 审核策略指南

## 🎯 推荐方案：一次性提交（分阶段启用）

### 第一阶段：提交审核（免费版功能完整，付费版功能存在但未启用）

#### 1. 代码准备

**确保以下功能完整：**
- ✅ 免费版功能完全可用（限制清单数量、分类数量）
- ✅ 付费版功能代码已实现（但通过配置开关控制）
- ✅ 权限检查逻辑完整
- ✅ UI 中明确标示付费功能（但暂时不触发购买）

**创建功能开关：**

```typescript
// src/constants/config.ts
export const FEATURE_FLAGS = {
  // 是否启用内购功能（审核时设为 false，审核通过后改为 true）
  ENABLE_IAP: false,
  
  // 是否显示付费功能入口（审核时设为 true，让审核员看到）
  SHOW_PREMIUM_FEATURES: true,
} as const;
```

#### 2. App Store Connect 配置

**提交审核时：**
- ✅ App 设置为免费下载
- ✅ 创建内购产品（但状态设为「准备提交」或「待审核」）
- ✅ 在 App 描述中说明：
  ```
  免费版功能：
  - 1 个清单
  - 2 个分类
  - 基础提醒功能
  
  付费版功能（即将推出）：
  - 无限清单
  - 无限分类
  - 云端同步
  - 分类套组
  ```

**在 App 中：**
- ✅ 显示「升级到付费版」按钮
- ✅ 点击后显示「功能即将推出」提示（不触发实际购买）
- ✅ 让审核员能看到完整的 UI 流程

#### 3. 审核说明

在「审核信息」中说明：
```
本版本包含完整的免费版和付费版功能架构。
付费版功能已实现但内购功能暂未启用，
将在后续版本中启用。当前版本仅展示功能界面。
```

### 第二阶段：审核通过后启用内购

**审核通过后：**
1. 将内购产品状态改为「准备提交」
2. 更新代码：`ENABLE_IAP: true`
3. 实现实际的内购流程
4. 提交小版本更新（通常审核更快）

---

## 🔄 替代方案：分两次提交（不推荐）

### 方案 A：先提交免费版

**优点：**
- 可以更快上线
- 先验证核心功能

**缺点：**
- 需要两次审核（时间成本高）
- 第二次提交时可能被问「为什么之前没有付费功能」
- 用户体验不连贯

### 方案 B：先提交付费版

**不推荐：**
- Apple 可能要求提供免费试用
- 审核更严格

---

## 📋 具体实施步骤

### Step 1: 准备代码（当前阶段）

```typescript
// src/utils/purchase.ts
import {FEATURE_FLAGS} from '@constants/config';

export const handleUpgradeClick = () => {
  if (!FEATURE_FLAGS.ENABLE_IAP) {
    // 审核阶段：显示「即将推出」
    Alert.alert(
      '功能即将推出',
      '付费版功能正在准备中，敬请期待！',
    );
    return;
  }
  
  // 生产环境：触发实际购买
  purchaseProduct(...);
};
```

### Step 2: App Store Connect 配置

1. **创建 App**
   - 名称：出門點點名
   - 价格：免费
   - 分类：生产力工具

2. **创建内购产品**
   - 产品 ID：`com.checkreadydiandianming.premium`
   - 类型：非消耗性产品
   - 价格：NT$ 60
   - 状态：**准备提交**（先不提交审核）

3. **填写 App 描述**
   ```
   出門點點名 - 出門前檢查清單 App
   
   【免費版功能】
   ✓ 1 個清單
   ✓ 2 個分類
   ✓ 每日提醒通知
   ✓ 拖拽排序
   ✓ 進度追蹤
   
   【付費版功能】（即將推出）
   ✓ 無限清單
   ✓ 無限分類
   ✓ 分類套組
   ✓ 雲端同步
   
   讓您出門前不再遺忘重要物品！
   ```

4. **上传截图**
   - 包含免费版功能截图
   - 可以包含「升级到付费版」界面截图（标注「即将推出」）

### Step 3: 提交审核

**审核信息填写：**
```
测试账户：不需要（免费版功能完整可用）

审核说明：
1. 本版本包含完整的免费版功能
2. 付费版功能界面已实现，但内购功能将在后续版本启用
3. 所有功能都可以正常使用（免费版限制已生效）
4. 付费功能入口已显示，点击后会提示「即将推出」
```

### Step 4: 审核通过后

1. **启用内购功能**
   ```typescript
   // src/constants/config.ts
   export const FEATURE_FLAGS = {
     ENABLE_IAP: true, // 改为 true
     SHOW_PREMIUM_FEATURES: true,
   };
   ```

2. **提交内购产品审核**
   - 在 App Store Connect 中将内购产品状态改为「准备提交」
   - 提交审核

3. **提交 App 更新**
   - 版本号：1.0.1
   - 更新说明：「启用付费版购买功能」
   - 通常审核会更快（因为只是启用已有功能）

---

## ⚠️ 重要注意事项

### 1. Apple 审核要求

- ✅ **必须提供免费功能**：不能强制用户付费才能使用核心功能
- ✅ **明确标示付费功能**：UI 中必须清楚标示哪些需要付费
- ✅ **功能描述准确**：App 描述必须与实际功能一致
- ✅ **测试账户**：如果付费功能需要测试，必须提供测试账户

### 2. 代码注意事项

- ✅ 确保免费版功能完整可用
- ✅ 权限检查逻辑必须正确
- ✅ 不能有硬编码的「付费版」测试代码
- ✅ 开发模式切换功能必须在生产环境禁用

### 3. 审核被拒的常见原因

- ❌ 付费功能描述不清晰
- ❌ 免费版功能太少（被认为「假免费」）
- ❌ 内购产品信息不完整
- ❌ 测试账户无法使用付费功能

---

## 🎯 推荐策略总结

**最佳实践：**
1. ✅ **一次性提交**包含两个权限版本的 App
2. ✅ **先不启用内购**，但显示付费功能入口
3. ✅ **审核通过后**再启用内购功能
4. ✅ **小版本更新**启用内购（审核更快）

**时间线：**
- Week 1: 准备代码和截图
- Week 2: 提交审核（免费版 + 付费版界面）
- Week 3: 审核通过，启用内购功能
- Week 4: 提交内购产品审核 + App 更新

**风险控制：**
- 如果审核被拒，只需要修改描述或截图，不需要改代码
- 内购功能可以独立审核，不影响 App 本身

---

## 📝 检查清单

### 提交前检查

- [ ] 免费版功能完整可用
- [ ] 付费版功能界面已实现
- [ ] 权限检查逻辑正确
- [ ] UI 中明确标示付费功能
- [ ] App 描述准确说明免费/付费功能
- [ ] 截图包含所有关键功能
- [ ] 内购产品已创建（但未提交）
- [ ] 开发模式功能已禁用
- [ ] 测试账户（如需要）已准备

### 启用内购前检查

- [ ] 内购产品信息完整
- [ ] 购买流程已实现
- [ ] 收据验证已实现
- [ ] 恢复购买功能已实现
- [ ] 错误处理完善
- [ ] 沙盒测试通过

